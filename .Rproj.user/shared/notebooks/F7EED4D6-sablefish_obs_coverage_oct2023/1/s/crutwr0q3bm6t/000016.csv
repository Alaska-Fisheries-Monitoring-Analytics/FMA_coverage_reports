"0","#table 2 proportion catch observed by observers or EM"
"0",""
"0","# .	This data is like the bottom panel of fig 4 (actual coverage of catch - %). Will now have a fig and table."
"0","# THIS TABLE IS NOT FULLY AUTOMATED. GEAR HEADERS NEED TO BE CHECKED (add_header_row flextable functions)"
"0",""
"0","areagear_tot <- casdat %>% "
"0","  filter(gear != ""JIG"") %>% "
"0","  group_by(year, mgmt_area, gear) %>% "
"0","  summarise(totcatch = sum(catch_mt))"
"0",""
"0","obs_prop <- casdat %>% "
"0","  filter(agency_gear_code != ""JIG"") %>% "
"0","  group_by(year, mgmt_area, observed, gear) %>% "
"0","  summarise(catch_mt = sum(catch_mt)) %>% "
"0","  inner_join(areagear_tot, by = c(""year"", ""mgmt_area"",""gear"")) %>% "
"0","  mutate(prop_catch = catch_mt/totcatch,"
"0","         Coverage = recode(observed, ""Catch Only""=""EM"", ""Catch/Biologicals""=""Observer"", ""None""=""No Coverage""))"
"0",""
"0","obs_prop$Coverage<- factor(obs_prop$Coverage, levels=c(""EM"",""Observer"",""No Coverage""))"
"0",""
"0","#create regional averages by gear and area"
"0","obs_prop_area_gear<-obs_prop %>%"
"0","  filter(gear!=""JIG"")%>%"
"0"," group_by(mgmt_area, gear) %>%"
"0","  summarize(catch_ag=sum(catch_mt))"
"0","#create regional avg by gear area, and coverage"
"0","obs_prop_area_gear_cov<-obs_prop %>%"
"0","  filter(gear!=""JIG"")%>%"
"0","  group_by(mgmt_area, gear, Coverage) %>%"
"0","  summarize(catch_agc=sum(catch_mt))"
"0","#create proportions of catch for all years"
"0","obs_prop_sum<-obs_prop_area_gear_cov%>%"
"0","  inner_join(obs_prop_area_gear, by=c(""mgmt_area""=""mgmt_area"", ""gear""=""gear"")) %>%"
"0","  mutate(prop_catch=catch_agc/catch_ag)"
"0",""
"0","#combine with obs_prop"
"0","obs_prop_dat<-obs_prop_sum%>%"
"0","  mutate(year=""Avg"")%>%"
"0","  dplyr::select(year, mgmt_area, gear, prop_catch, Coverage) %>%"
"0","  bind_rows(obs_prop%>%"
"0","              filter(year %in% (endyear-4):endyear) %>%"
"0","              dplyr::select(year, mgmt_area, gear, prop_catch, Coverage))%>%"
"0","  mutate(perc_catch=round((prop_catch*100),0))"
"0",""
"0","tab2cap<-paste0(""Table "", params$chapter, ""."", params$appendix, "".2. The proportion of "", params$name, "" catch observed by observers (Obs) or electronic monitoring (EM) by area and gear for the most recent five years and the average proportions from 2013 through the current year. The remainder of the catch had no observer coverage. Gear types include pelagic trawl (PTR), non-pelagic trawl (NPT), pot (POT), or hook and line (HAL). Areas include the Aleutian Islands (AI), Bering Sea (BS), Western Gulf of Alaska (WGOA), Central Gulf of Alaska (CGOA), West Yakutat (WY), and East Yakutat (EY)."")"
"0",""
"0","ft2<-obs_prop_dat%>%"
"0","  filter(Coverage!=""No Coverage"")%>%"
"0","  mutate(Year=year, Area=mgmt_area)%>%"
"0","    pivot_wider(id_cols=c(Area, Year), names_from=c(Coverage, gear), values_from=perc_catch)%>%"
"0","  arrange(Area, Year) %>%"
"0","  flextable() %>%"
"0","  #delete_part(part=""header"") %>%"
"0","    fontsize(size=11, part=""all"")%>%"
"0","    line_spacing(space = 0.3, part = ""body"")%>%"
"0"," # add_header_row(top = TRUE, values = c(""Area"", ""Year"", ""% Obs"", ""% Obs"", ""% EM"", ""% Obs"", ""% EM"", ""% Obs"" )#, colwidths = c(1,3,3)"
"0"," #                )%>%"
"0"," # add_header_row(top = TRUE, "
"0","  #  values = c("""", """", ""PTR"", ""NPT"", ""POT"",""POT"", ""HAL"", ""HAL"" )#, colwidths = c(1,3,3)"
"0","   #              )%>%"
"0","  add_header_lines(values = tab2cap) %>%"
"0","    align(align = ""right"", part=""body"") %>%"
"0","      align(align = ""left"", part=""header"", i=1) %>%"
"0","  align(align = ""right"", part=""header"", i=2:3) %>%"
"0","  font(part = ""all"", fontname = ""Times New Roman"") %>%"
"0","  border(part = ""head"", i = 2,"
"0","         border = list(""width"" = 0, color = ""black"", style = ""solid""))"
"2","Error in get_rows_id(x[[part]], i) : 
  invalid row selection: out of range selection
"
